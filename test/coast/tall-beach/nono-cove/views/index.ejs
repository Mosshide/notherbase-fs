<p>
    nono
</p>

<hr>

<div class="chat-box" id="test-box">
    <div class="chat-name">Chatting using the name <%= user.username %>:</div>

    <div class="chat-log">
        
    </div>

    <input autocomplete="off" type="text" name="text" class="chat-entry">
    <div value="Send" class="chat-send">Send</div>
</div>

<hr>

<h3>Game Test</h3>

<button onclick="addToTime()">Add</button>
<p id="timer">0:00</p>

<hr>

<button onclick="tradeForDoll()" id="trade">Trade 5g for a doll</button>

<hr>

<section class="floor" id="items">
    <h2>Items</h2>
    <button id="toggle">Toggle</button>

    <div class="content invisible">
        <ul class="items">

        </ul>
    
        <div class="editor">
            <div class="edit invisible">
                <h5>Item Name:</h5>
                <input type="text" id="name">
            
                <h5>Short Item Description:</h5>
                <textarea id="short" name="short" cols="30" rows="3"></textarea>
            
                <h5>Full Item Description:</h5>
                <textarea id="full" name="full" cols="30" rows="10"></textarea>

                <button id="cancel" onclick="itemFloor.cancelEdit()">Cancel</button>
                <button id="save" onclick="itemFloor.saveSelectedItem()">Save</button>
            </div>

            <div class="read">
                <h5 id="name">Item Name</h5>
            
                <h5>Short Item Description:</h5>
                <p id="short"></p>
            
                <h5>Full Item Description:</h5>
                <p id="full"></p>

                <button id="new" onclick="itemFloor.createNewItem()">Create New</button>
                <button id="edit" onclick="itemFloor.editSelectedItem()">Edit</button>
                <button id="delete" onclick="itemFloor.deleteSelectedItem()">Delete</button>
                <button id="refresh" onclick="itemFloor.updateItems()">Refresh List</button>
            </div>
        </div>
    </div>
</section>

<hr>

<a href="/the-front" class="to">
    Go to The Front
</a>

<a href="/coast/tall-beach/nono-cove/nono-og" class="to">
    Go to Nono Cove
</a>


<script src="/js/chat-box.js"></script>
<script>
    let chatTest = new ChatBox("<%= user.username %>", "test-box", "testRoom");

    let bought = false;

    let tradeForDoll = async function tradeForDoll() {
        if (!bought) {
            $("#trade").addClass("invisible");

            let paid = await playerInventory.change("Gold Coin", -5);
            
            if (paid) {
                bought = true;
                await playerInventory.change("Rag Doll", 1);
            }
            else {
                $("#trade").removeClass("invisible");
            }
        }
    }

    let time = 0;

    let addToTime = async function addToTime() {
        try {
            time += 10;

            await $.post(`/coast/tall-beach/nono-cove/index/save`, { timer: time, lastTime: Date.now() }, function () {
                $("#timer").text(Math.floor(time));
            });
        } catch (error) {
            console.log(error);
        }
    }

    let getTime = async function getTime() {
        try {
            await $.get(`/coast/tall-beach/nono-cove/index/load`, function (data) {
                console.log(data);
                data.timer = parseFloat(data.timer);
                data.lastTime = parseFloat(data.lastTime);
                console.log(data);
                console.log(Date.now());
                time = data.timer - ((Date.now() - data.lastTime) / 1000);
                if (time < 0) time = 0;
                $("#timer").text(Math.floor(time));
            });
        } catch (error) {
            console.log(error);
        }
    }
    
    let updateTime = function updateTime() {
        if (time > 0) {
            time--;
            if (time < 0) time = 0;
            $("#timer").text(Math.floor(time));
        }
        
    }

    setInterval(updateTime, 1000);
    getTime();
</script>